{"version":3,"file":"main.js","sources":["../src/utils/data/class.ts","../src/utils/v3/user-position.ts"],"sourcesContent":["import type { ClassType } from '@zvms/zvms4-types'\nimport dayjs from 'dayjs'\n\ninterface Class {\n  type: 'Z' | 'J'\n  grade: number\n  class: number\n  year: number\n}\n\nexport function getUserGrade(year: number) {\n  const y = dayjs().year()\n  return y - year + (dayjs().month() < 8 ? 0 : 1)\n}\n\nexport function getUserClass(id: number, code?: number) {\n  const classinfo = code ? getUserClassByCode(code) : getUserClassByNumber(id)\n  const grade = getUserGrade(classinfo.year)\n  return {\n    type: classinfo.type,\n    grade,\n    class: classinfo.class,\n    year: classinfo.year\n  } as ClassType\n}\n\nexport function getUserClassByNumber(id: number) {\n  const classid = Math.floor((id % 10000) / 100)\n  const type = classid > 10 ? 'J' : 'Z'\n  const classord = classid % 10\n  const year = Math.floor(id / 10000)\n  const grade = getUserGrade(year)\n  return {\n    type,\n    year,\n    grade,\n    class: classord\n  } as Class\n}\n\nexport function getUserClassByCode(code: number): Class {\n  const year = Math.floor((code % 1000000) / 10000) + 2000\n  const grade = getUserGrade(year)\n  const classid = Math.floor((code % 10000) / 100)\n  if (code.toString(8).startsWith('09')) {\n    return {\n      type: classid <= 8 ? 'Z' : 'J',\n      year,\n      grade,\n      class: classid <= 8 ? classid : classid - 8\n    }\n  } else if (code.toString(8).startsWith('39')) {\n    return {\n      type: classid <= 2 ? 'Z' : 'J',\n      year,\n      grade,\n      class: classid <= 2 ? classid : classid - 2\n    }\n  } else {\n    return {\n      type: 'Z',\n      year,\n      grade: 0,\n      class: classid\n    }\n  }\n}\n\nexport function getClassName(classType: Class) {\n  const title = classType.type === 'J' ? '蛟' : '高'\n  const grades = ['一', '二', '三']\n  if (classType.grade === 0) return '未知班级'\n  if (classType.class === 0) return `${classType.year} 级`\n  if (classType.grade > 3)\n    return `${classType.year} 级 ${\n      classType.class > 10 ? `蛟 ${classType.class - 10}` : `${classType.class}`\n    } 班`\n  const grade = grades[classType.grade - 1]\n  return `${title}${grade}（${classType.class % 10}）班`\n}\n\nexport function getUserClassName(id: number, code?: number) {\n  return getClassName(getUserClass(id, code))\n}\n","import type { UserPosition } from '@zvms/zvms4-types'\n\nexport function getUserPosition(permission: number) {\n  /**\n   * 1. Student - 0\n   * 2. Secretary - 1\n   * 3. Auditor - 2\n   * 4. Department - 4\n   * 4. Inspector - 8\n   * 5. Admin - 16\n   * 6. System - 32\n   * Stackable, Unique\n   */\n  const isStudent = true\n  const isSecretary = permission & 1\n  const isDepartment = permission & 2\n  const isAutidor = permission & 4\n  const isInspector = permission & 8\n  const isAdmin = permission & 16\n  const isSystem = permission & 32\n  console.log(\n    isStudent,\n    isSecretary,\n    isDepartment,\n    isAutidor,\n    isInspector,\n    isAdmin,\n    isSystem,\n    permission\n  )\n  return ['student', 'secretary', 'department', 'auditor', 'inspector', 'admin', 'system'].filter(\n    (_, i) => [isStudent, isSecretary, isDepartment, isAutidor, isInspector, isAdmin, isSystem][i]\n  ) as UserPosition[]\n}\n"],"names":[],"mappings":"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"}